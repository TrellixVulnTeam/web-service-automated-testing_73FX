config:
  target: 'https://web-service-testing.herokuapp.com'
  timeout: 3
  ensure:
    p95: 1000
  phases:
    - duration: 60
      arrivalRate: 5
      name: Warm up
    - duration: 120
      arrivalRate: 5
      rampTo: 50
      name: Ramp up load
    - duration: 600
      arrivalRate: 50
      name: Sustained load
    - duration: 60
      arrivalRate: 5000
      name: Trending load
  defaults:
    headers:
      content-type: "application/json"
scenarios:
  - name: "Create User"
  - flow:
    - post:
        url: "/createuser"
        json:
          username: "omikrom"
          password: "123456"
          name: "richard"
          email: "1802749@student.uwtsd.ac.uk"
        capture:
          json: "$.id"
          as: "id"
        expect:
          - statusCode: 201 
    - log: "Sent create request id: {{ id }}"
    - think: 3
    - get:
        url: "/user/{{ id }}"
        expect:
          - statusCode: 200
    - think: 6
    - patch:
        url: "/user/{{ id }}"
        json:
          username: "omikrom2"
          password: "123456"
          name: "richardo"
          email: "1802749@student.uwtsd.ac.uk"
        capture:
          json: "$.username"
          as: "username"
        expect:
          - statusCode: 200
    - log: "{{ username }}"
    - think: 3
    - get:
        url: "/user"
        qs:
          username: "omikrom2"
        capture:
          json: "$.id"
          as: "newId"
    - log: "{{ newId }}"
    - think: 5
    - delete:
        url: "/user/{{ newId }}"
        capture:
          json: "$.id"
          as: "deleteId"
    - log: "{{ deleteId }}"

